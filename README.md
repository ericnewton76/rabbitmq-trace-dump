# RabbitMQ Trace Dump

A .NET 8 command-line tool for reading, parsing, and displaying RabbitMQ trace log files with support for BSON payload decoding and interactive navigation.

## Features

- ğŸ“„ **Parse RabbitMQ trace logs** - Read JSON-formatted trace files generated by RabbitMQ's tracing plugin
- ğŸ” **BSON payload decoding** - Automatically decode Base64-encoded BSON payloads into readable JSON
- ğŸ¨ **Syntax-highlighted output** - Color-coded JSON output using Spectre.Console
- ğŸ§­ **Interactive mode** - Navigate through records with keyboard controls
- ğŸ” **Filtering/Search** - Filter records by property values
- ğŸ‘ï¸ **Hide properties** - Exclude specific properties from output

## Installation

### Prerequisites

- [.NET 8 SDK](https://dotnet.microsoft.com/download/dotnet/8.0) or later

### Build from Source

## Usage

`rabbitmq-trace-dump [options] <input-file>`

### Arguments

| Argument | Description |
|----------|-------------|
| `<input-file>` | Path to the RabbitMQ trace log file |

### Options

| Option | Description |
|--------|-------------|
| `-p` | Pretty print JSON output with indentation |
| `-i` | Enable interactive mode for navigating records |
| `--hide <props>` | Comma-separated list of properties to hide from output |
| `--search <expr>` | Filter records by property value (e.g., `routing_key=my.key`) |

### Examples

**Basic usage - dump all records:**

## Interactive Mode Controls

When running with `-i`, use these keyboard shortcuts:

| Key | Action |
|-----|--------|
| <kbd>â†“</kbd> / <kbd>Space</kbd> | Next record |
| <kbd>â†‘</kbd> | Previous record |
| <kbd>/</kbd> | Enter search filter |
| <kbd>S</kbd> | Skip a specified number of records |
| <kbd>R</kbd> | Reset to beginning of file |
| <kbd>H</kbd> | Show help |
| <kbd>Esc</kbd> | Exit |

## Search Operators

| Operator | Description |
|----------|-------------|
| `=` | Equals (case-insensitive) |
| `==` | Equals (case-insensitive) |
| `~==` | Pattern match |

## Payload Decoding

The tool automatically detects and decodes payloads in the following formats:

1. **BSON** - Base64-encoded BSON documents are deserialized and displayed as JSON
2. **ASCII** - Falls back to ASCII string decoding if BSON parsing fails

This is particularly useful when working with applications that serialize messages using MongoDB's BSON format.

## Dependencies

- [CommandLineParser](https://github.com/commandlineparser/commandline) - Command-line argument parsing
- [MongoDB.Bson](https://www.nuget.org/packages/MongoDB.Bson) - BSON serialization/deserialization
- [Newtonsoft.Json](https://www.newtonsoft.com/json) - JSON parsing and manipulation
- [Spectre.Console](https://spectreconsole.net/) - Syntax-highlighted console output

## Setting Up RabbitMQ Tracing

To generate trace logs in RabbitMQ:

1. Enable the tracing plugin:
`rabbitmq-plugins enable rabbitmq_tracing`

2. Create a trace via the Management UI or API:
`rabbitmqctl trace_on -p /`

3. Configure trace output to a file (via Management UI under **Admin >Tracing**)

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

This project is open source. See the repository for license details.
